<section class="content">
  <div class="content-block">
    <div class="block-header">
      <!-- breadcrumb -->
      <app-breadcrumb [title]="'Manage Profile'" [items]="['Profile']" [active_item]="'Manage Profile'">
      </app-breadcrumb>
    </div>
    <div class="row clearfix">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
        <div class="card">
          <div class="m-2" *ngIf="!showForm || posting">
            <mat-progress-bar color="primary" mode="indeterminate">
            </mat-progress-bar>
          </div>
          <div class="body" *ngIf="showForm">
            <div class="header">
              <div class="row">
                <h2>{{ pageFunction }} Profile</h2>
              </div>
            </div>
            <div class="m-2" *ngIf="isGlDetailsProcessing">
              <mat-progress-bar color="primary" mode="indeterminate">
              </mat-progress-bar>
            </div>
            <app-gl-details *ngIf="enteredGlAccount" [glAccount]="enteredGlAccount"
              (glDetailsChange)="onGlDetailsChange($event)" (glDetailsProcessing)="onGlDetailsProcessing($event)">
            </app-gl-details>

            <form class="mx-4" [formGroup]="mngForm">
              <div class="row">
                <!-- <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                    <mat-form-field class="example-full-width mb-0" appearance="outline">
                      <mat-label>Year Established</mat-label>
                      <input matInput formControlName="yearEstablished" type="number" required />
                      <mat-error *ngIf="mngForm.get('yearEstablished').hasError('required')">Year Established is required</mat-error>
                    </mat-form-field>
                  </div> -->

                <!-- <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                    <mat-form-field class="example-full-width mb-0" appearance="outline">
                      <mat-label>Company Size</mat-label>
                      <input matInput formControlName="companySize" required />
                      <mat-error *ngIf="mngForm.get('companySize').hasError('required')">Company Size is required</mat-error>
                    </mat-form-field>
                  </div> -->

                <!-- <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                    <mat-form-field class="example-full-width mb-0" appearance="outline">
                      <mat-label>Number of Employees</mat-label>
                      <input matInput formControlName="numberOfEmployees" type="number" required />
                      <mat-error *ngIf="mngForm.get('numberOfEmployees').hasError('required')">Number of Employees is required</mat-error>
                    </mat-form-field>
                  </div> -->

                <!-- <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                    <mat-form-field class="example-full-width mb-0" appearance="outline">
                      <mat-label>Industry</mat-label>
                      <input matInput formControlName="industry" required />
                      <mat-error *ngIf="mngForm.get('industry').hasError('required')">Industry is required</mat-error>
                    </mat-form-field>
                  </div> -->

                <!-- <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                    <mat-form-field class="example-full-width mb-0" appearance="outline">
                      <mat-label>Products and Services</mat-label>
                      <mat-select formControlName="productsAndServices" required>
                        <mat-option *ngFor="let option of productsAndServicesOptions" [value]="option.value">{{ option.label }}</mat-option>
                      </mat-select>
                      <mat-error *ngIf="mngForm.get('productsAndServices').hasError('required')">Products and Services is required</mat-error>
                    </mat-form-field>
                  </div>
                   -->

                <!-- <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                    <mat-form-field class="example-full-width mb-0" appearance="outline">
                      <mat-label>Tax ID</mat-label>
                      <input matInput formControlName="taxId" required />
                      <mat-error *ngIf="mngForm.get('taxId').hasError('required')">Tax ID is required</mat-error>
                    </mat-form-field>
                  </div> -->

                <!-- <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                    <mat-form-field class="example-full-width mb-0" appearance="outline">
                      <mat-label>PO Delivery Email</mat-label>
                      <input matInput formControlName="poDeliveryEmail" required />
                      <mat-error *ngIf="mngForm.get('poDeliveryEmail').hasError('required')">PO Delivery Email is required</mat-error>
                    </mat-form-field>
                  </div> -->
                <!--                 
                  <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                    <mat-form-field class="example-full-width mb-0" appearance="outline">
                      <mat-label>Ownership Type</mat-label>
                      <input matInput formControlName="ownershipType" required />
                      <mat-error *ngIf="mngForm.get('ownershipType').hasError('required')">Ownership Type is required</mat-error>
                    </mat-form-field>
                  </div> -->
                <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 mb-2">
                  <section class="example-section">
                    <span class="example-margin">Caritas Account?</span>
                    <mat-radio-group formControlName="hasCaritasAccount" (change)="accountLogic($event)">
                      <mat-radio-button class="example-margin" value="Y">Yes</mat-radio-button>
                      <mat-radio-button class="example-margin" value="N">No</mat-radio-button>
                    </mat-radio-group>
                  </section>
                </div>

                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                  <mat-form-field class="example-full-width mb-0" appearance="outline">
                    <mat-label>Bank Name</mat-label>
                    <input matInput formControlName="bankName" readonly required />
                    <mat-icon matSuffix (click)="banksLookUp()">search</mat-icon>
                    <mat-error *ngIf="mngForm.get('bankName').hasError('required')">Bank Name is required</mat-error>
                  </mat-form-field>
                </div>
                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                  <mat-form-field class="example-full-width mb-0" appearance="outline">
                    <mat-label>To Bank ID</mat-label>
                    <input matInput formControlName="toBankID" required />
                    <mat-error *ngIf="mngForm.get('toBankID').hasError('required')">To Bank ID is required</mat-error>
                  </mat-form-field>
                </div>

                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                  <mat-form-field class="example-full-width mb-0" appearance="outline">
                    <mat-label>Branch Name</mat-label>
                    <input matInput formControlName="branchName" readonly required />
                    <mat-icon matSuffix (click)="branchesLookUp()">search</mat-icon>
                    <mat-error *ngIf="mngForm.get('branchName').hasError('required')">Branch Name is
                      required</mat-error>
                  </mat-form-field>
                </div>
                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                  <mat-form-field class="example-full-width mb-0" appearance="outline">
                    <mat-label>To Branch ID</mat-label>
                    <input matInput formControlName="toBranchID" required />
                    <mat-error *ngIf="mngForm.get('toBranchID').hasError('required')">To Branch ID is
                      required</mat-error>
                  </mat-form-field>
                </div>
                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                  <mat-form-field class="example-full-width mb-0" appearance="outline">
                    <mat-label>Bank Account</mat-label>
                    <input matInput formControlName="bankAc" required
                      (input)="accountNumberCheck($event.target.value)" />
                    <mat-error *ngIf="mngForm.get('bankAc').hasError('required')">Bank Account is required</mat-error>
                  </mat-form-field>
                </div>

                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                  <mat-form-field class="example-full-width mb-0" appearance="outline">
                    <mat-label>Account Name</mat-label>
                    <input matInput formControlName="bankAcName" required />
                    <mat-error *ngIf="mngForm.get('bankAcName').hasError('required')">Bank Account Name is
                      required</mat-error>
                  </mat-form-field>
                </div>

                <div class="col-xl-2 col-lg-2 col-md-6 col-sm-12 mb-1">
                  <mat-form-field class="example-full-width mb-0" appearance="outline">
                    <mat-label>Currency</mat-label>
                    <input matInput formControlName="currency" required />
                    <mat-error *ngIf="mngForm.get('currency').hasError('required')">Currency is required</mat-error>
                  </mat-form-field>
                </div>

                <!-- <div class="col-xl-10 col-lg-10 col-md-12 col-sm-12 mb-1">
                  <mat-form-field class="example-full-width mb-0" appearance="outline">
                    <mat-label>Remarks</mat-label>
                    <textarea matInput formControlName="remarks" required></textarea>
                    <mat-error *ngIf="mngForm.get('remarks').hasError('required')">Remarks is required</mat-error>
                  </mat-form-field>
                </div> -->
              </div>
            </form>

            <mat-tab-group>
              <mat-tab>
                <ng-template mat-tab-label>
                  <mat-icon>attach_file</mat-icon> Upload Profile Attachments
                </ng-template>
                <div class="mt-3">
                  <!-- Content for the second tab -->
                  <form [formGroup]="documentsForm">
                    <!-- <form [formGroup]="form"> -->

                    <div style="margin: 20px">
                      <div class="table-responsive">
                        <div class="materialTableHeader">
                          <div class="row">
                            <div class="col-8">
                              <ul class="header-buttons-left ms-0">
                                <li class="dropdown">
                                  <h2>Upload Documents</h2>
                                </li>
                                <li class="dropdown m-l-20">
                                  <label for="search-input"><i class="material-icons search-icon">search</i></label>
                                  <input placeholder="Filter..." type="text" (keyup)="applyFilter($event)" #filter
                                    class="browser-default search-field" aria-label="Search box" />
                                </li>

                                <li>
                                  <div class="m-l-10" matTooltip="ADD">
                                    <button mat-mini-fab color="primary" (click)="addFileRow()">
                                      <mat-icon class="col-white">add</mat-icon>
                                    </button>
                                  </div>
                                </li>
                              </ul>
                            </div>
                            <div class="col-4"></div>
                          </div>
                        </div>

                        <!-- <table mat-table [dataSource]="dataSource" formArrayName="filedetails"> -->
                        <mat-table #table matTableExporter [dataSource]="attachementsDataSource"
                          formArrayName="filedetails" matSort class="mat-cell" #exporter="matTableExporter">
                          <ng-container matColumnDef="id">
                            <mat-header-cell *matHeaderCellDef mat-sort-header
                              class="column-nowrap psl-3 tbl-col-width-per-6 mt-2">Id</mat-header-cell>
                            <mat-cell *matCellDef="let row; let index = index" [formGroupName]="index"
                              class="column-nowrap psl-3 tbl-col-width-per-6">
                              {{ index + 1 }}
                            </mat-cell>
                          </ng-container>
                          <ng-container matColumnDef="documentType">
                            <mat-header-cell *matHeaderCellDef mat-sort-header
                              class="column-nowrap psl-3 tbl-col-width-per-50">Document Type</mat-header-cell>
                            <mat-cell *matCellDef="let trow; let tindex = index" [formGroupName]="tindex"
                              class="column-nowrap psl-3 tbl-col-width-per-50">
                              <mat-form-field appearance="fill" class="dropdown-container">
                                <mat-label>Document Type</mat-label>
                                <mat-select formControlName="documentType">
                                  <mat-option *ngFor="let type of documentTypes" [value]="type.value">{{ type.label
                                    }}</mat-option>
                                </mat-select>
                              </mat-form-field>
                            </mat-cell>
                          </ng-container>

                          <ng-container matColumnDef="filename">
                            <mat-header-cell *matHeaderCellDef mat-sort-header
                              class="column-nowrap psl-3 tbl-col-width-per-50 filename-cell">Filename</mat-header-cell>
                            <mat-cell *matCellDef="let row; let index = index" [formGroupName]="index"
                              class="column-nowrap psl-3 tbl-col-width-per-50 filename-cell">
                              <mat-form-field class="example-full-width mt-2 mr-5" appearance="fill">
                                <mat-label>Filename</mat-label>
                                <input matInput type="text" formControlName="filename" placeholder="Filename"
                                  maxlength="50" readonly />
                              </mat-form-field>
                            </mat-cell>
                          </ng-container>
                          <ng-container matColumnDef="filetype">
                            <mat-header-cell *matHeaderCellDef mat-sort-header
                              class="column-nowrap psl-3 tbl-col-width-per-50 filename-cell">Filetype</mat-header-cell>
                            <mat-cell *matCellDef="let row; let index = index" [formGroupName]="index"
                              class="column-nowrap psl-3 tbl-col-width-per-50 filename-cell">
                              <mat-form-field class="example-full-width mt-2 mr-5" appearance="fill">
                                <mat-label>Filetype</mat-label>
                                <input matInput type="text" formControlName="filetype" placeholder="Filetype"
                                  maxlength="50" readonly />
                              </mat-form-field>
                            </mat-cell>
                          </ng-container>

                          <ng-container matColumnDef="selectFile">
                            <mat-header-cell *matHeaderCellDef mat-sort-header
                              class="column-nowrap psl-3 tbl-col-width-per-50 selectfile-cell">Select
                              File</mat-header-cell>
                            <mat-cell *matCellDef="let row; let index = index" [formGroupName]="index"
                              class="column-nowrap psl-3 tbl-col-width-per-50 selectfile-cell">
                              <input #file type="file" [disabled]="isLoading | async"
                                (change)="onSelectFile(file.files, row, index)" [multiple]="'multiple'" />
                            </mat-cell>
                          </ng-container>

                          <ng-container matColumnDef="download">
                            <mat-header-cell class="column-nowrap psl-3 tbl-col-width-per-30"
                              *matHeaderCellDef>Download</mat-header-cell>
                            <mat-cell *matCellDef="let row; let i = index"
                              class="column-nowrap psl-3 tbl-col-width-per-30">
                              <button mat-icon-button color="primary" (click)="$event.stopPropagation()"
                                (click)="downloadDocument(row)" class="tbl-action-btn">
                                <mat-icon aria-label="Download">file_download</mat-icon>
                              </button>
                            </mat-cell>
                          </ng-container>

                          <ng-container matColumnDef="action">
                            <mat-header-cell class="column-nowrap psl-3 tbl-col-width-per-30"
                              *matHeaderCellDef>Action</mat-header-cell>
                            <mat-cell *matCellDef="let row; let i = index"
                              class="column-nowrap psl-3 tbl-col-width-per-30">
                              <button mat-icon-button color="accent" (click)="$event.stopPropagation()"
                                (click)="deleteCall(row)" class="tbl-action-btn">
                                <app-feather-icons [icon]="'trash-2'" [class]="'tbl-fav-delete'"></app-feather-icons>
                              </button>
                            </mat-cell>
                          </ng-container>

                          <!-- Row definitions -->
                          <mat-header-row *matHeaderRowDef="displayColumns"></mat-header-row>
                          <mat-row *matRowDef="
                              let row;
                              let i = index;
                              columns: displayColumns
                            " [style.cursor]="'pointer'" matRipple></mat-row>
                          <mat-cell *matNoDataRow colspan="4">No data matching the filter "{{
                            input.value
                            }}"</mat-cell>
                        </mat-table>

                        <!-- Loading spinner -->
                        <div *ngIf="isFileDataLoading" class="tbl-spinner">
                          <mat-progress-spinner color="primary" [diameter]="40" mode="indeterminate">
                          </mat-progress-spinner>
                        </div>
                        <mat-paginator [pageSize]="10" [pageSizeOptions]="[2, 5, 10, 20, 30, 40, 50, 100]"
                          aria-label="Select page of users"></mat-paginator>
                      </div>
                    </div>
                  </form>
                </div>
              </mat-tab>
            </mat-tab-group>

            <div class="row m-t-25">
              <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-1">
                <div class="example-button-row" align="end">
                  <button class="btn-space" type="button" mat-raised-button color="warn" mat-button (click)="cancel()">
                    <mat-icon>cancel</mat-icon>
                    Cancel
                  </button>

                  <ng-container *ngIf="!hideApprovals">
                    <button class="btn-space" [disabled]="formData.approvedByHOD" (click)="onValidate('HOD')"
                      mat-raised-button color="primary">
                      <mat-icon>done_outline</mat-icon>
                      HOD Approval
                    </button>

                    <button class="btn-space" [disabled]="
                        !formData.approvedByHOD ||
                        formData.approvedByProcurement
                      " (click)="onValidate('PROCUREMENT')" mat-raised-button color="primary">
                      <mat-icon>shopping_cart</mat-icon>
                      Procurement Approval
                    </button>
                  </ng-container>

                  <!-- <button class="btn-space" *ngIf="pageFunction === 'Add'" [disabled]="!mngForm.valid || dataSource.data.length === 0"
                      [hidden]="hideSubmit" mat-raised-button color="primary" (click)="performBudgetCheck()">
                      <mat-icon>compare_arrows</mat-icon>
                      Compare With Budget
                    </button> -->

                  <button class="btn-space" [class.auth-spinner]="posting" [disabled]="!mngForm.valid"
                    [hidden]="hideSubmit" (click)="onSubmit()" mat-raised-button color="primary">
                    <mat-icon>file_download</mat-icon>
                    {{ pageFunction }} Profile
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>